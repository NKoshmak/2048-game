const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.score=0,this.status="idle",this.initialState=t,this.state=this.cloneState(this.initialState)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this.addRandomTile(),this.addRandomTile())}restart(){this.state=this.cloneState(this.initialState),this.score=0,this.status="idle"}moveUp(){this.handleMove("up")}moveDown(){this.handleMove("down")}moveLeft(){this.handleMove("left")}moveRight(){this.handleMove("right")}handleMove(t){"playing"===this.status&&this.slide(t)&&(this.addRandomTile(),this.updateGameStatus())}cloneState(t){return t.map(t=>[...t])}addRandomTile(){let t=this.findEmptyTiles();if(t.length>0){let e=Math.floor(Math.random()*t.length),[s,a]=t[e];this.state[s][a]=.9>Math.random()?2:4}}findEmptyTiles(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.state[e][s]&&t.push([e,s]);return t}slide(t){let e=this.cloneState(this.state);switch(t){case"left":this.state=this.slideLeft(this.state);break;case"right":this.state=this.slideRight(this.state);break;case"up":this.state=this.transpose(this.slideLeft(this.transpose(this.state)));break;case"down":this.state=this.transpose(this.slideRight(this.transpose(this.state)))}return!this.areStatesEqual(this.state,e)}slideLeft(t){return t.map(t=>this.processRow(t,!0))}slideRight(t){return t.map(t=>this.processRow(t,!1))}processRow(t,e){let s=e?t:[...t].reverse(),a=this.mergeTiles(s.filter(t=>0!==t));for(;a.length<4;)a.push(0);return e?a:a.reverse()}mergeTiles(t){for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);return t.filter(t=>0!==t)}areStatesEqual(t,e){for(let s=0;s<4;s++)for(let a=0;a<4;a++)if(t[s][a]!==e[s][a])return!1;return!0}transpose(t){let e=[];for(let s=0;s<4;s++){e[s]=[];for(let a=0;a<4;a++)e[s].push(t[a][s])}return e}updateGameStatus(){if(this.hasReached2048()){this.status="win";return}this.hasEmptyCells()||this.canMergeTiles()||(this.status="lose")}hasReached2048(){return this.state.some(t=>t.includes(2048))}hasEmptyCells(){return this.state.some(t=>t.includes(0))}canMergeTiles(){for(let t=0;t<4;t++)for(let e=0;e<4;e++){let s=this.state[t][e];if(e<3&&s===this.state[t][e+1]||t<3&&s===this.state[t+1][e])return!0}return!1}},e=document.querySelectorAll(".field-cell"),s=document.querySelector(".button.start"),a=document.querySelector(".message-win"),i=document.querySelector(".message-lose"),r=document.querySelector(".message-start"),l=document.querySelector(".game-score");function h(){let s=t.getState(),r=t.getStatus(),h=0;for(let o=0;o<4;o++){for(let t=0;t<4;t++){let a=e[h];a.className="field-cell",s[o][t]?(a.textContent=s[o][t],a.classList.add(`field-cell--${s[o][t]}`)):a.textContent="",h++}l.textContent=t.getScore(),"win"===r?a.classList.remove("hidden"):"lose"===r&&i.classList.remove("hidden")}}s.addEventListener("click",()=>{"button restart"===s.className&&t.restart(),t.start(),h(),a.classList.add("hidden"),i.classList.add("hidden"),r.classList.add("hidden"),s.textContent="Restart",s.className="button restart"}),document.addEventListener("keydown",e=>{if("playing"===t.getStatus()){switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown()}h()}});
//# sourceMappingURL=index.1077be24.js.map
